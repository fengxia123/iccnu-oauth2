<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Iccnu-oauth2 : iccnu的oauth2认证服务说明文档">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Iccnu-oauth2</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ccnuyan/iccnu-oauth2">View on GitHub</a>

          <h1 id="project_title">Iccnu-oauth2</h1>
          <h2 id="project_tagline">iccnu的oauth2认证服务说明文档</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/ccnuyan/iccnu-oauth2/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/ccnuyan/iccnu-oauth2/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="iccnu-oauth2-authentication-flow-instruction" class="anchor" href="#iccnu-oauth2-authentication-flow-instruction" aria-hidden="true"><span class="octicon octicon-link"></span></a>ICCNU Oauth2 Authentication Flow Instruction</h1>

<hr>

<h2>
<a id="before-you-begin" class="anchor" href="#before-you-begin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Before You Begin</h2>

<p>这里是各应用的 OAuth2 的认证流程，而不涉及OAuth2的授权。
  你需要考虑你的应用是哪种情形，分别使用不同的认证方式，其中针对应用的不同类型B/S应用需要参考Authorization Code Flow，C/S应用需要参考Resource Owner Flow；另外针对应用是否已上线并存在用户群体，需要参考不同的创建新用户或banding已有账户的方式。</p>

<hr>

<h4>
<a id="1租户为bs应用" class="anchor" href="#1%E7%A7%9F%E6%88%B7%E4%B8%BAbs%E5%BA%94%E7%94%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.租户为B/S应用</h4>

<p>需要参考 Authorization Code Grant Flow，用户在认证站点登录并跳转至您的应用后，应提示用户绑定已有账户或直接创建新用户，后进入登录状态。</p>

<h4>
<a id="2租户为cs应用" class="anchor" href="#2%E7%A7%9F%E6%88%B7%E4%B8%BAcs%E5%BA%94%E7%94%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.租户为C/S应用</h4>

<p>需要参考 Resource Owner Flow，用户登录至您的应用后，应提示用户绑定已有账户或直接创建新用户，后进入登录状态。</p>

<h2>
<a id="1-租户为bs应用-authorization-code-grant-flow" class="anchor" href="#1-%E7%A7%9F%E6%88%B7%E4%B8%BAbs%E5%BA%94%E7%94%A8-authorization-code-grant-flow" aria-hidden="true"><span class="octicon octicon-link"></span></a>1 租户为B/S应用: Authorization Code Grant Flow</h2>

<h4>
<a id="使用先决条件" class="anchor" href="#%E4%BD%BF%E7%94%A8%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用先决条件</h4>

<ol>
<li><p>你的用户需要现在ICCNU上注册为用户。</p></li>
<li>
<p>你需要将你的应用申请成为ICCNU认证服务的租户。
租户需要为站点提供的信息包括</p>

<p>回调地址 "redirectURI" : "http://localhost:8080/account/login"
租户应用Id "id" : "code_test"
租户应用密码 "secret" : *****
主页地址 "homeURI" : "http://localhost:8080/"
租户应用名 "name" : "测试应用名1"
租户应用描述 "description" : "这里是测试应用1的描述信息"
认证类型 "authType" : "code"</p>

<p>其中，回调地址、租户应用Id及租户应用密码为Authorization Code Grant Flow认证流程中需要用到的必须字段; 主页地址，租户应用名, 租户应用描述为显示给用户的字段，不是必须的；认证类型在Authorization Code Grant Flow中固定为"Code"。   </p>
</li>
</ol>

<h4>
<a id="认证流程" class="anchor" href="#%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>认证流程</h4>

<p>1 用户点击租户应用网页上的“使用ICCNU账户登录”时，携带租户注册参数（包括回调地址，租户应用Id，认证类型等）跳转到认证页面。</p>

<p>2 用户登录后，认证页面呈现你的应用信息及用户个人信息，用户授权租户应用（用户授权租户、表示用户允许租户应用通过获得到的AccessToken访问认证主站的服务，包括网盘服务，资源服务等，获得到用户的资源）之后，携带code跳转回你的应用的回调页面。</p>

<p>3 回调页面在处理逻辑中，携带code及租户的信息（包括回调地址，租户应用Id，租户应用密码，认证类型）及申请访问的服务域（暂为全域）等，调用认证站点的token服务，得到用户的AccessToken。</p>

<p>4 租户通过AccessToken调用认证站点的Me服务，得到用户的认证信息，认证流程结束。</p>

<p>此时租户已经知道调用认证站点ICCNU登录的用户的基本信息，可以继续租户自己的业务（绑定已存在的本地用户或者根据登录信息创建用户等等）。</p>

<h2>
<a id="1-租户为cs应用-resource-owner-flow" class="anchor" href="#1-%E7%A7%9F%E6%88%B7%E4%B8%BAcs%E5%BA%94%E7%94%A8-resource-owner-flow" aria-hidden="true"><span class="octicon octicon-link"></span></a>1 租户为C/S应用: Resource Owner Flow</h2>

<h4>
<a id="使用先决条件-1" class="anchor" href="#%E4%BD%BF%E7%94%A8%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用先决条件</h4>

<ol>
<li><p>你的用户需要现在ICCNU上注册为用户。</p></li>
<li>
<p>你需要将你的应用申请成为ICCNU认证服务的租户。
租户需要为站点提供的信息包括</p>

<p>租户应用Id "id" : "code_test"
租户应用密码 "secret" : *****
主页地址 "homeURI" : "http://localhost:8080/"
租户应用名 "name" : "测试应用名1"
租户应用描述 "description" : "这里是测试应用1的描述信息"
认证类型 "authType" : "resource_owner"</p>

<p>其中，租户应用Id及租户应用密码为Resource Owner Flow认证流程中需要用到的必须字段; 主页地址，租户应用名, 租户应用描述为显示给用户的字段，不是必须的；认证类型在Authorization Code Grant Flow中固定为"resource_owner"。<br>
C/S应用并不是在浏览器中进行认证流程，所以不需要提供回调地址字段。</p>
</li>
</ol>

<h4>
<a id="认证流程-1" class="anchor" href="#%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>认证流程</h4>

<p>1 用户点击客户端的“使用ICCNU账户登录”时，输入在认证站点上注册的用户名与密码。</p>

<p>2 客户端在后台携带用户输入的用户名与密码及租户的信息（包括回调地址，租户应用Id，租户应用密码，认证类型）及申请访问的服务域（暂为全域）等，调用认证站点的token服务，得到用户的AccessToken。</p>

<p>3 租户通过AccessToken调用认证站点的Me服务，得到用户的认证信息，认证流程结束。</p>

<p>此时租户已经知道调用认证站点ICCNU登录的用户的基本信息，可以继续租户自己的业务（绑定已存在的本地用户或者根据登录信息创建用户等等）。</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Iccnu-oauth2 maintained by <a href="https://github.com/ccnuyan">ccnuyan</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
